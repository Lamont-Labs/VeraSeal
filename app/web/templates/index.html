<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeraSeal</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>VeraSeal</h1>
            <p class="subtitle">Record decisions. Prove how they were made. Verify them later.</p>
        </header>

        <div class="card">
            <p>This system creates permanent, tamper-evident records of important decisions. It exists so you can answer: What happened, why, and can we prove it?</p>
        </div>

        <div class="card">
            <h2>Example: Vendor Approval</h2>
            <p>A compliance team approves a new vendor. Months or years later, an auditor asks why the vendor was approved and what rules were applied at the time.</p>
            <p>This system produces a permanent record showing:</p>
            <ul>
                <li>The exact information reviewed</li>
                <li>The rules applied</li>
                <li>The decision result</li>
                <li>Proof the record has not been altered</li>
            </ul>
        </div>

        <div class="warning-box">
            <h3>This system does NOT</h3>
            <ul>
                <li>Take actions</li>
                <li>Execute transactions</li>
                <li>Change external systems</li>
                <li>Run autonomously</li>
                <li>Make decisions for you</li>
            </ul>
            <p style="margin-top: 12px; margin-bottom: 0;"><strong>It evaluates, records, and proves decisions — nothing more.</strong></p>
        </div>

        <div class="card">
            <h2>Who it's for</h2>
            <p style="margin-bottom: 0;">Teams responsible for decisions that must hold up under review — including compliance, risk, audit, legal, and regulated operations.</p>
        </div>

        <div class="card">
            <h2>How it works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-text">Submit the decision details</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text">System evaluates under fixed rules</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text">A proof bundle is generated and stored</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-text">Replay verifies nothing changed</div>
                </div>
            </div>
            <p style="margin-top: 16px; margin-bottom: 0; text-align: center;">The same input will always produce the same result.</p>
        </div>

        <div class="card">
            <h2>Getting Started</h2>
            <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                <li>Scroll down to the form below</li>
                <li>Click "Load a real example" to see sample data, or paste your own</li>
                <li>Click "Generate decision proof" to create your record</li>
                <li>Save the Proof ID — use it later to verify the record is unchanged</li>
            </ol>
            <p style="margin-top: 12px; margin-bottom: 0;">That's it. Your decision is now recorded with permanent proof.</p>
        </div>

        <div class="card">
            <h2>What you get</h2>
            <p>Every evaluation produces a downloadable proof bundle containing:</p>
            <ul>
                <li>The exact input you submitted</li>
                <li>The decision result</li>
                <li>A step-by-step trace of the evaluation</li>
                <li>A manifest of file hashes for integrity</li>
                <li>A replay verification report</li>
            </ul>
        </div>

        <div class="card" id="generate-section">
            <h2>What this tool does</h2>
            <p>This tool records a decision and produces a permanent proof showing what was reviewed, what rules were applied, and why the outcome occurred.</p>
            <p><small>No actions are taken. Nothing is automated. This system evaluates and records only.</small></p>
            
            <h2 style="margin-top: 24px;">Decision Details (Structured Format)</h2>
            <p>Paste the exact information that was reviewed when the decision was made.</p>
            
            <label for="requestInput">Decision Details (Structured Format)</label>
            <textarea id="requestInput">{
  "version": "v1",
  "subject": "vendor-onboarding",
  "ruleset": "policy-check",
  "payload": {
    "assert": true,
    "vendor_name": "Acme Corp",
    "requires_nda": true,
    "country": "US"
  },
  "injected_time_utc": "2024-01-15T10:30:00Z"
}</textarea>
            <p style="margin-top: 8px; color: var(--text-secondary); font-size: 0.875rem;">The same input will always produce the same proof.</p>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="submitEvaluation()">Generate decision proof</button>
                <button class="btn btn-secondary" onclick="loadExample()">Load a real example</button>
            </div>
            <p style="margin-top: 12px; color: var(--text-secondary); font-size: 0.875rem;">This creates a permanent, verifiable record of the decision.</p>
            
            <div id="result"></div>
        </div>

        <div class="card">
            <h2>Verify an Existing Proof</h2>
            <p>Use this to confirm that a previously generated decision record has not been altered.</p>
            <div style="display: flex; gap: 12px; margin-top: 12px;">
                <input type="text" id="verifyId" placeholder="Enter Proof ID" style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                <button class="btn btn-secondary" onclick="verifyProof()">Verify Proof</button>
            </div>
        </div>
    </div>

    <script>
        function loadExample() {
            document.getElementById('requestInput').value = JSON.stringify({
                "version": "v1",
                "subject": "vendor-onboarding",
                "ruleset": "policy-check",
                "payload": {
                    "assert": true,
                    "vendor_name": "Acme Corp",
                    "requires_nda": true,
                    "country": "US"
                },
                "injected_time_utc": "2024-01-15T10:30:00Z"
            }, null, 2);
            document.getElementById('requestInput').scrollIntoView({ behavior: 'smooth' });
        }

        async function submitEvaluation() {
            const input = document.getElementById('requestInput').value;
            const resultDiv = document.getElementById('result');
            
            let parsed;
            try {
                parsed = JSON.parse(input);
            } catch (e) {
                resultDiv.innerHTML = '<div class="result-box result-error" style="margin-top: 16px;"><strong>Proof not generated.</strong> The input is not valid JSON.<br><br><code>' + e.message + '</code></div>';
                return;
            }
            
            try {
                const response = await fetch('/evaluate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(parsed)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="result-box result-success" style="margin-top: 16px;">' +
                        '<strong>Decision Proof Generated</strong><br><br>' +
                        '<span class="proof-id">' + data.evaluation_id + '</span><br><br>' +
                        '<a href="/evaluations/' + data.evaluation_id + '" class="btn btn-primary">View Proof Record</a>' +
                        '</div>';
                } else {
                    resultDiv.innerHTML = '<div class="result-box result-error" style="margin-top: 16px;">' +
                        '<strong>Proof not generated.</strong> The input is invalid or incomplete.<br><br>' +
                        '<code>' + (data.detail || JSON.stringify(data)) + '</code></div>';
                }
            } catch (e) {
                resultDiv.innerHTML = '<div class="result-box result-error" style="margin-top: 16px;"><strong>Request failed.</strong><br>' + e.message + '</div>';
            }
        }

        function verifyProof() {
            const proofId = document.getElementById('verifyId').value.trim();
            if (proofId) {
                window.location.href = '/replay/' + proofId;
            }
        }
    </script>
</body>
</html>
